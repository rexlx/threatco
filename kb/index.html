<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threatco Knowledge Center</title>
    <style>
        /* 1. Define the fonts available in your static directory */
        @font-face {
            font-family: 'IBMPlexMono';
            src: url('/static/fonts/IBMPlexMono-Regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        
        @font-face {
            font-family: 'IBMPlexSans';
            src: url('/static/fonts/IBMPlexSans-Regular.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }

        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --border-color: #000000;
            --code-bg: #f4f4f4;
            --accent-color: #0000ff; /* Neon Blue for Light Mode */
            --accent-glow: 0 0 2px #0000ff;
        }

        body.dark-mode {
            --bg-color: #0a0a0a;
            --text-color: #e0e0e0;
            --border-color: #333333;
            --code-bg: #1a1a1a;
            --accent-color: #00ff41; /* Neon Green for Dark Mode */
            --accent-glow: 0 0 8px rgba(0, 255, 65, 0.5);
        }

        * {
            box-sizing: border-box;
        }

        body {
            /* 2. Use the local font here */
            font-family: 'IBMPlexMono', 'Courier New', monospace; 
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header & Nav */
        header {
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 20px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px -5px var(--accent-color);
        }

        h1 { margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        
        nav {
            margin-bottom: 50px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        nav a {
            text-decoration: none;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            text-transform: uppercase;
            font-size: 0.9em;
            transition: 0.2s;
        }

        nav a:hover {
            border-color: var(--accent-color);
            box-shadow: var(--accent-glow);
            color: var(--accent-color);
        }

        /* Content Sections */
        section {
            margin-bottom: 60px;
            border-left: 1px solid var(--border-color);
            padding-left: 30px;
            position: relative;
        }

        section:hover {
            border-left: 2px solid var(--accent-color);
            box-shadow: -4px 0 15px -5px var(--accent-glow);
        }

        h2 {
            margin-top: 0;
            text-transform: uppercase;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 10px;
            display: inline-block;
        }

        h3 {
            margin-top: 30px;
            color: var(--accent-color);
            text-transform: lowercase;
        }

        /* Elements */
        pre {
            background: var(--code-bg);
            padding: 15px;
            overflow-x: auto;
            border-left: 4px solid var(--border-color);
            font-family: 'IBMPlexMono', monospace;
        }

        code {
            background: var(--code-bg);
            padding: 2px 5px;
            font-family: 'IBMPlexMono', monospace;
        }

        ul { list-style-type: square; }

        /* Images / Screenshots */
        img.screenshot {
            display: block;
            margin: 30px auto;
            max-width: 100%;
            width: 700px;
            height: auto;
            border: 1px solid var(--border-color);
            padding: 5px;
            background-color: var(--bg-color);
        }
        
        section:hover img.screenshot {
            border-color: var(--accent-color);
            box-shadow: var(--accent-glow);
        }

        /* Toggle Button */
        #theme-toggle {
            background: none;
            border: 1px solid var(--text-color);
            color: var(--text-color);
            padding: 5px 15px;
            cursor: pointer;
            font-family: 'IBMPlexMono', monospace;
            text-transform: uppercase;
        }

        #theme-toggle:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
            box-shadow: var(--accent-glow);
        }
    </style>
</head>
<body class="dark-mode">

<div class="container">
    <header>
        <div>
            <h1>Threatco</h1>
            <small>Knowledge Center</small>
        </div>
        <button id="theme-toggle">Toggle Theme</button>
    </header>

    <nav>
        <a href="#frontend">Frontend</a>
        <a href="#extension">Extension</a>
        <a href="#server">Server</a>
        <a href="#api">API</a>
        <a href="#deploy">Deploy</a>
        <a href="#deps">Dependencies</a>
    </nav>

    <section id="frontend">
        <h2>Frontend Administration</h2>
        <p>Documentation for live server administration.</p>

        <h3>Login</h3>
        <p>Enter the server URL in your browser, input credentials, and log in to view the dashboard.</p>
        <img src="images/home.png" alt="Login Screen" class="screenshot">
        
        <h3>Users</h3>
        <p><strong>View/Delete:</strong> Manage users via the "Users" menu.</p>
        <img src="images/users.png" alt="User Management" class="screenshot">

        <p><strong>Add User:</strong></p>
        <ol>
            <li>Click "Add User" in nav bar.</li>
            <li>Fill in details.</li>
            <li>Click "Add". Copy the one-time key provided.</li>
        </ol>
        <img src="images/adduser.png" alt="Add User Screen" class="screenshot">
        
        <p><strong>Edit User:</strong> To change a password, currently you must delete and re-add the user.</p>

        <h3>Services & Stats</h3>
        <p>View details about configured services in the "Services" tab, and view logs/graphs in the "Logs" and "Stats" menus respectively.</p>
    </section>

    <section id="extension">
        <h2>Insights Extension</h2>
        
        <h3>Menu</h3>
        <p><strong>Services:</strong> Enable/Disable server-side services. Syncs per user.</p>
        <p><strong>Profile:</strong> Configure server URL and API email/key.</p>
        <img src="images/menu960.png" alt="Extension Menu" class="screenshot">

        <h3>Search</h3>
        <p>Accepts text blobs, parses indicators, and sends matches to enabled services. Keeps a history of 24 results (FIFO).</p>
        <img src="images/search960.png" alt="Extension Search" class="screenshot">
    </section>

    <section id="api">
        <h2>API</h2>
        <p>Authorization required via header: <code>Authorization: user@place.com:key_here</code> or a valid Session Cookie.</p>

        <h3>Core & User Management</h3>
        <p><strong>GET /getuptime</strong> - Returns server uptime details.</p>
        <p><strong>GET /user</strong> - Returns details for the authenticated user.</p>
        <p><strong>GET /getservices</strong> - Returns available services configuration.</p>
        <p><strong>POST /adduser</strong> - Create a new user (Admin only).</p>
        <pre>Request: {"email": "user@example.com", "password": "password", "admin": "true"}</pre>

        <h3>Data & Analysis</h3>
        <p><strong>POST /parse</strong> - Extracts IOCs (indicators of compromise) from a text blob.</p>
        <pre>Request: {"blob": "Suspicious IP 1.2.3.4 found...", "username": "email@place.com"}
Response: JSON Array of matches</pre>

        <p><strong>POST /pipe</strong> - Proxy a request to a specific vendor service.</p>
        <pre>Request: {"value": "8.8.8.8", "to": "virustotal", "type": "ipv4", "username": "email@place.com"}</pre>

        <p><strong>GET /logs</strong> - Returns system logs.</p>
        <pre>Query Params: ?start=0&end=50</pre>

        <p><strong>GET /events/:id</strong> - Retrieve a specific raw cached response by its ID.</p>


        <h3>Case Management</h3>
        <p><strong>GET /cases/list</strong> - List all open cases.</p>
        <p><strong>POST /cases/create</strong> - Create a new investigation case.</p>
        <pre>Request: {"name": "Incident 101", "description": "Phishing analysis"}</pre>
        <p><strong>GET /cases/get</strong> - Retrieve full details of a specific case.</p>
        <pre>Query Param: ?id=CASE_UUID</pre>
        <p><strong>POST /cases/update</strong> - Update case details.</p>
        <p><strong>POST /cases/delete</strong> - Delete a case.</p>

        <h3>Tools</h3>
        <p><strong>POST /tools/dnslookup2</strong> - Perform a synchronous DNS/Reverse lookup.</p>
        <pre>Query Param: ?value=8.8.8.8</pre>
        <p><strong>POST /tools/checksum</strong> - Calculate SHA256 of an uploaded file.</p>
        <p><strong>POST /tools/encrypt</strong> - Encrypt a file or text string.</p>
        <p><strong>POST /tools/decrypt</strong> - Decrypt a file.</p>
        <p><strong>POST /tools/parse</strong> - Parse an uploaded file for indicators.</p>

        <h3>Integrations</h3>
        <p><strong>POST /misp-workflow</strong> - Create a MISP event from a single attribute.</p>
        <pre>Request: {"event_info": "ThreatCo Alert", "attribute_value": "1.1.1.1", "attribute_type": "ip-dst"}</pre>
        <p><strong>POST /misp/workflow/batch</strong> - Batch create a MISP event with multiple attributes.</p>
        <pre>Request: {
  "event_info": "Batch Import",
  "attributes": [{"value": "1.1.1.1", "type": "ip-dst"}]
}</pre>
    </section>

    <section id="server">
        <h2>Server Configuration</h2>
        <p>Configuration located in <code>data/config.json</code>:</p>
        <ul>
            <li><code>server_id</code>: Unique identifier.</li>
            <li><code>first_user_mode</code>: If true, allows only one user creation.</li>
            <li><code>bind_address</code> & <code>fqdn</code>: Network settings.</li>
            <li><code>services</code>: List of services used.</li>
            <li><code>http_port</code> / <code>https_port</code>: Listening ports.</li>
            <li><code>tls_cert</code> / <code>tls_key</code>: SSL paths.</li>
            <li><code>db_location</code>: Path to database file or connection string.</li>
            <li><code>session_token_ttl</code>: Session duration (minutes).</li>
        </ul>
    </section>

    <section id="deploy">
        <h2>Deployment</h2>
        
        <h3>Requirements</h3>
        <p><strong>OS:</strong> Linux recommended (tested on Mac/Windows).</p>
        <p><strong>Hardware (High Load):</strong> 6 cores, 8GB RAM, 128GB Storage.</p>
        <p><strong>Software:</strong> Go 1.23+, Git.</p>

        <h3>Basic Install</h3>
        <pre>git clone https://github.com/rexlx/threatco.git
cd threatco
go build .
./threatco -config data/config.json -kb ./kb/</pre>

        <h3>Docker</h3>
        <pre>docker build -t threatco .
docker run -d -p 8081:8081 threatco</pre>
    </section>

    <section id="deps">
        <h2>Dependencies</h2>
        <h3>Software</h3>
        <ul>
            <li>github.com/alexedwards/scs/v2</li>
            <li>github.com/go-echarts/go-echarts/v2</li>
            <li>github.com/google/uuid</li>
            <li>go.etcd.io/bbolt (Embedded DB)</li>
            <li>github.com/jackc/pgx/v5 (Postgres DB)</li>
            <li>golang.org/x/crypto</li>
        </ul>
        <h3>Frontend</h3>
        <ul>
            <li>HTMX</li>
            <li>Bulma CSS</li>
            <li>IBMPlex Fonts</li>
        </ul>
    </section>

    <footer>
        <p><a href="/services" style="color: var(--text-color);">‚Üê Back to App</a></p>
    </footer>
</div>

<script>
    const toggleButton = document.getElementById('theme-toggle');
    const body = document.body;

    // Check for saved preference
    if (localStorage.getItem('theme') === 'light') {
        body.classList.remove('dark-mode');
    }

    toggleButton.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        // Save preference
        if (body.classList.contains('dark-mode')) {
            localStorage.setItem('theme', 'dark');
        } else {
            localStorage.setItem('theme', 'light');
        }
    });
</script>

</body>
</html>